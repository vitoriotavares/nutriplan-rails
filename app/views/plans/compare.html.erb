<div class="max-w-6xl mx-auto my-12 px-4">
  <h1 class="text-3xl font-bold text-center text-gray-800 mb-12 flex items-center justify-center">
    <i class="fas fa-balance-scale text-green-600 mr-3"></i>
    Comparação de Planos
  </h1>
  
  <div class="text-center mb-10">
    <p class="text-lg text-gray-600 max-w-3xl mx-auto">
      Compare os recursos disponíveis em cada plano e escolha o que melhor atende às suas necessidades.
    </p>
  </div>
  
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-lg shadow-lg overflow-hidden">
      <thead>
        <tr>
          <th class="px-6 py-4 bg-gray-50 text-left text-sm font-medium text-gray-500 uppercase tracking-wider w-1/3">
            Recursos
          </th>
          <% @plans.each do |plan| %>
            <th class="px-6 py-4 text-center <%= plan.price.zero? ? 'bg-gray-50' : 'bg-green-50' %>">
              <div class="flex flex-col items-center">
                <span class="text-lg font-bold text-gray-800 mb-2">
                  <i class="<%= plan.price.zero? ? 'fas fa-seedling text-green-500' : 'fas fa-crown text-yellow-500' %> mr-1"></i>
                  <%= plan.name %>
                </span>
                <span class="text-2xl font-bold text-gray-900">
                  <%= plan.price.zero? ? 'Grátis' : number_to_currency(plan.price) %>
                </span>
                <% unless plan.price.zero? %>
                  <span class="text-sm text-gray-500">/mês</span>
                <% end %>
              </div>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Planos alimentares mensais
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if plan.food_plans_limit.zero? %>
                <span class="font-medium">Ilimitados</span>
              <% else %>
                <span class="font-medium"><%= plan.food_plans_limit %></span>
              <% end %>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Acesso a receitas
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if plan.full_recipe_access %>
                <span class="font-medium text-green-600">Acesso completo</span>
              <% else %>
                <span>Acesso básico</span>
              <% end %>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Suporte ao cliente
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if plan.priority_support %>
                <span class="font-medium text-green-600">Prioritário</span>
              <% else %>
                <span>Padrão</span>
              <% end %>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Exportação para PDF
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <i class="fas fa-check text-green-500"></i>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Análise nutricional
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <i class="fas <%= plan.price.zero? ? 'fa-times text-gray-400' : 'fa-check text-green-500' %>"></i>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Histórico de refeições
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if plan.price.zero? %>
                <span>7 dias</span>
              <% else %>
                <span class="font-medium text-green-600">Ilimitado</span>
              <% end %>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Compartilhamento de planos
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <i class="fas <%= plan.price.zero? ? 'fa-times text-gray-400' : 'fa-check text-green-500' %>"></i>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 text-sm font-medium text-gray-700 bg-gray-50">
            Anúncios
          </td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-4 text-center text-sm text-gray-600 <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if plan.price.zero? %>
                <i class="fas fa-check text-gray-400"></i>
              <% else %>
                <span class="font-medium text-green-600">Sem anúncios</span>
              <% end %>
            </td>
          <% end %>
        </tr>
        
        <tr>
          <td class="px-6 py-4 bg-gray-50"></td>
          <% @plans.each do |plan| %>
            <td class="px-6 py-6 text-center <%= plan.price.zero? ? '' : 'bg-green-50' %>">
              <% if current_user %>
                <% if @current_plan && @current_plan.id == plan.id %>
                  <div class="inline-block py-2 px-4 bg-gray-100 text-gray-700 rounded text-sm font-medium">
                    <i class="fas fa-check mr-1"></i> Seu plano atual
                  </div>
                <% else %>
                  <%= link_to new_subscription_path(plan_id: plan.id), class: "inline-block py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white #{plan.price.zero? ? 'bg-gray-600 hover:bg-gray-700' : 'bg-green-600 hover:bg-green-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" do %>
                    <%= plan.price.zero? ? 'Começar agora' : 'Assinar plano' %>
                  <% end %>
                <% end %>
              <% else %>
                <%= link_to login_path, class: "inline-block py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
                  Entrar para assinar
                <% end %>
              <% end %>
            </td>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="mt-12 bg-gray-50 p-6 rounded-lg border border-gray-200">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">Perguntas Frequentes</h3>
    
    <div class="space-y-4 mt-6">
      <div class="border border-gray-200 rounded-md overflow-hidden">
        <button class="w-full flex justify-between items-center px-4 py-3 bg-white text-left focus:outline-none" onclick="toggleFAQ(this)">
          <span class="font-medium text-gray-700">Como funciona a cobrança?</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </button>
        <div class="hidden px-4 py-3 bg-gray-50">
          <p class="text-gray-600 text-sm">
            A cobrança é feita mensalmente através do Mercado Pago. Você será cobrado no mesmo dia a cada mês. Por exemplo, se você assinar no dia 15, será cobrado novamente no dia 15 do próximo mês.
          </p>
        </div>
      </div>
      
      <div class="border border-gray-200 rounded-md overflow-hidden">
        <button class="w-full flex justify-between items-center px-4 py-3 bg-white text-left focus:outline-none" onclick="toggleFAQ(this)">
          <span class="font-medium text-gray-700">Posso mudar de plano depois?</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </button>
        <div class="hidden px-4 py-3 bg-gray-50">
          <p class="text-gray-600 text-sm">
            Sim, você pode fazer upgrade ou downgrade do seu plano a qualquer momento. Se fizer upgrade, a diferença será cobrada proporcionalmente ao tempo restante do seu período atual. Se fizer downgrade, a mudança ocorrerá no próximo ciclo de cobrança.
          </p>
        </div>
      </div>
      
      <div class="border border-gray-200 rounded-md overflow-hidden">
        <button class="w-full flex justify-between items-center px-4 py-3 bg-white text-left focus:outline-none" onclick="toggleFAQ(this)">
          <span class="font-medium text-gray-700">Como cancelar minha assinatura?</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </button>
        <div class="hidden px-4 py-3 bg-gray-50">
          <p class="text-gray-600 text-sm">
            Você pode cancelar sua assinatura a qualquer momento através da página "Minhas Assinaturas" no seu perfil. Após o cancelamento, você continuará tendo acesso aos recursos premium até o final do período já pago.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleFAQ(button) {
    const content = button.nextElementSibling;
    const icon = button.querySelector('i');
    
    if (content.classList.contains('hidden')) {
      content.classList.remove('hidden');
      icon.classList.remove('fa-chevron-down');
      icon.classList.add('fa-chevron-up');
    } else {
      content.classList.add('hidden');
      icon.classList.remove('fa-chevron-up');
      icon.classList.add('fa-chevron-down');
    }
  }
</script>
